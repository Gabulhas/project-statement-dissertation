\chapter{Core Concepts and State of the Art}

The consensus mechanism is a critical component of any blockchain network. It determines the rules for validating transactions and adding them to the blockchain. In order to understand the current development and innovation in this area, it is important to have a solid understanding of the core concepts of blockchains as well as the current state of the art in consensus algorithms. This chapter aims to provide an overview of both of these key topics.

\section{Core Concepts}
% TODO: Mudar "For better understanding...."
% TODO: Mudar "Mudar isto, visto que está desatualizado"
This section focuses on the fundamental building blocks of decentralized systems like block\-chains.

This section covers State Machine Replication (SMR), Blockchain Data Structure and Networks, Network Models, and the Concept of Consensus.
Understanding these concepts is crucial for understanding how blockchains networks function, the different trade-offs and design considerations involved in creating and operating a blockchain network. The section starts with an overview of SMR and how it provides consistency and availability in decentralized systems.
Then, the concept of Blockchain Data Structure and its application in decentralized networks is explored. The different Network Models in distributed systems, such as synchronous, asynchronous, and partially-synchronous are also discussed. Finally, the section concludes with a discussion on the importance of consensus in blockchain networks.

% For a better understanding, this chapter describes the fundamental concepts of the topic of this thesis, which revolves around State Machine Replication, Blockchains and Consensus and other topics related to Networks.
% A consensus algorithm refers to the method used by a network to reach agreement on a set of values in a distributed system. Blockchains, on the other hand, are append-only ledgers that are linked to each other by cryptographic hash functions, making them immutable. Blockchains can be considered as State Machine Replication as they store the current state of a system, and the consensus algorithm ensures that every copy of the ledger is updated consistently. The FLP theorem, Partial Synchrony, and BFT algorithms are related to the topic of consensus algorithms, and will be explained in this section. This thesis uses the Tezos blockchain as a case study, due to its ability to easily swap and upgrade its consensus algorithm, making it a suitable platform to study these topics.

\subsection*{\textbf{State Machine Replication}}
%TODO: Adicionar aos acrónimos
%TODO: Verificar o que eu disse
%TODO: Falar do CAP System e fazer referencias
State Machine Replication (SMR) is the concept of replicating data in a distributed system, where nodes in a system maintain the same state of a machine.

In this approach, a node broadcasts an update to its state using a total order broadcast, and all other nodes receive the same updates in the same order and apply it to their own state.

\textbf{Total order broadcast} refers to notion of broadcasting messages in a specific order, such that all nodes in the network receive the messages in the same order, even if the messages are sent from different nodes at different times.

The main advantages of using SMR, like mentioned before, are that it can provide both \textbf{consistency} and \textbf{availability} (in some cases it only provides availability), making it a popular choice for use in blockchain technology, databases, file systems, and other decentralized systems.

Consistency, because it guarantees that every node contains the same state of the machine (not necessarily at the same time), and availability is also ensured because, in case of a node failure, there are other nodes in the system that have the information.

Overall, the concept of State Machine Replication is a fundamental component of decentralized systems that plays a crucial role in ensuring the consistency and availability of shared data. In case of Blockchains, to ensure that every node has the same chain and that there's no single point of failure of the whole system. This makes Blockchain Networks reliable, since in case multiple nodes fail in the network, the network can still operate, and that no single node has the power over the whole information, making the network decentralized. 


\subsection*{\textbf{Blockchain Data Structure and Networks}}
Blockchain is a data structure made of blocks that is often compared to a linked list (to which blocks are the nodes of the list), that are connected to a previous block in the chain by referencing to it, that is usually the hash of the block it is pointing to.

That is, every block, except for the first block (also called ``Genesis'' block), contains the hash of it's previous (or parent) block.

Once a block is added to the blockchain, it cannot be altered or deleted, making the ledger tamper-resistant and immutable, since, in order to change a block's information, one would need to change every child's block hash.
It's also possible to say that, the older the block, the more ``immutable'' it is, or the bigger the number of child blocks a block has, the harder is the tampering of such block.
Figure \ref{fig:blockchain} illustrates the blockchain datastructure, where it's possible that the last block ``Block N'' points to it's parent, and so on.

\begin{figure}[H]
    \centering
    \includegraphics[width=\textwidth,keepaspectratio]{imagens/blockchain.png}
    \caption{Blockchain Datastructure.}
    \label{fig:blockchain}

\end{figure}

Since it is used to record transactions, a blockchain can be considered a ``ledger'', and it's transparent, as all transactions are recorded.

There are networks, like Bitcoin and Ethereum that store and replicate the blockchain (where the chain is the State Machine), with no central authority or entity controlling the network, like mentioned in the previous section. This makes the state of the blockchain highly available, since there are multiple nodes that contain it's information. 

%TODO: Adicionar referencia) (These mechanisms will be explained in detail in later subsections
The network reaches consensus on the contents of a new block through the use of consensus mechanisms, such as Proof of Work or Proof of Stake, which will be described in the next section (\ref{stateoftheart}).
The blockchain is a distributed ledger, with all nodes in the network having a copy of the ledger, ensuring availability of the state.

The blockchain can be considered the state of a machine, where copies of the state of this machine is stored in multiple nodes, and newer states, that is, the process of appending a new block to the chain, are replicated to every machine in the network.

Beyond cryptocurrency, blockchains have a wide range of potential applications in various industries, like supply chain management, voting systems, and identity verification. The transparent nature of blockchains ensures that all transactions are publicly accessible and verifiable. The cryptographic functions used in blockchains, such as hashing and consensus mechanisms, provide a high level of security to the ledger and its transactions, and the replication of it ensures the availability of the information.

In conclusion, blockchain is a data structure that leverages the concepts of state machine replication to provide availability, leverages the concepts of cryptographic concepts to make it secure, imutable and tamper-resistant ledger where all transactions are recorded, making it transparent.
The decentralized nature of blockchains networks and the use of consensus mechanisms ensure that all nodes in the network have the same state of the chain, providing the availability to access of this information.

\subsection*{\textbf{Network Models}}

The concept of network types is a fundamental aspect of distributed systems and plays a crucial role in their design and implementation of these systems. There are three main types of networks in distributed systems: synchronous, asynchronous, and partially-synchronous. Each type of network has different properties and characteristics that affect the behavior of distributed algorithms and protocols, and it is important to understand these differences in order to design effective and efficient systems.

\textbf{Synchronous networks} are characterized by having a common notion of time and upper bounds on message delay. 
That is, in the Synchronous model, a finite time limit $\Delta$ is established and known. The adversary can only delay the delivery of a message sent by at most $\Delta$ time.
This means that the network can guarantee that messages will be delivered within a certain amount of time and that all nodes in the network have a consistent view of the current time. This type of network is relevant when strict timing constraints are necessary, such as in real-time systems.

\textbf{Asynchronous networks} \cite{bracha1985asynchronous}, on the other hand, neither have a common notion of time nor guarantee upper bounds on message delay. 
In this type of network, messages may be delayed indefinitely, and nodes in the network may have a different view of the current time. Asynchronous networks are relevant when timing constraints are not strict, such as in data-centric systems. The unpredictability of message delays makes asynchronous networks more challenging to design and implement, but they are also more robust and can handle failures and network partitions more effectively.

\textbf{Partially-synchronous networks} \cite{dwork1988consensus} are a hybrid of synchronous and asynchronous models.
% TODO adicionar referncias a isto
They have a common notion of time but only provide partial guarantees on message delay. In this type of network, some messages may be delivered within a certain amount of time, while others may be delayed indefinitely. Partially-synchronous networks are relevant in scenarios where some timing constraints are necessary, but not all and is often used in blockchain systems, such as Tendermint \cite{buchman2016tendermint}(used in Cosmos Network \cite{tendermintinc}and others), and Tezo's blockchain take on this protocol, Tenderbake \cite{acstefanoaei2020tenderbake}, which balance the need for speed and reliability with the need for resilience and robustness.

In conclusion, the concept of network types is critical in the design and implementation of distributed systems. Understanding the differences between the three networks can help protocol designers make informed decisions about the type of network that best suits their needs and can ensure the success of their systems.

\subsection*{\textbf{Consensus}}
% TODO:  Falar dos tipos de blockchain (permissionless e permissioned) e de como se relacionam com o CAP (como têm de ser Partition Tolerant, e ser Available, a consistency is lacking)
Consensus in Distributed Systems refers to the process of achieving agreement among all participants in a network on the state of a shared database or system.

While State Machine Replication is the concept of broadcasting the update of a state, consensus is the concept of how the nodes replicate and decide on a replicated value.

One way to implement total order broadcast, that is, to broadcast messages or updates to the state machine in a specific order, is by sending messages via a designated leader node. But if the leader becomes unavailable, the approach fails. 

So, nodes have to reach an agreement together, in a decentralized manner, on what is the next state of the replicated machine (or who's going to be the next leader), and should not be decided by a single node, and this being the coequally the concept of consensus.

Consensus protocols are \textbf{critical} to the blockchain context because they are the mechanisms that allow the network participants to agree on the state of the distributed ledger. In a blockchain network, transactions are submitted and processed by nodes in a decentralized manner, and the consensus protocol ensures that all nodes have the same view of the ledger and agree on which transactions are valid and should be included in the next block. Also, consensus algorithms enable the selection of the next leader, that is, the node that takes the transactions, builds the block and broadcasts the new block to the networks. 

This is important for maintaining the integrity and reliability of the blockchain, as well as for enabling trust in the network among participants who may not necessarily trust each other. A well-designed consensus protocol is essential for ensuring that the blockchain is able to process transactions efficiently and securely, even in the face of network failures, attacks, or other challenges.




\subsection*{Theorems}
% TODO: Adicionar referencia
There are several important theorems related to consensus algorithms that are relevant to the context of Blockchain Networks, as these are used to attribute characteristics to this type of networks, which include the \textbf{FLP} Theorem \cite{fischer1985impossibility} and the \textbf{CAP} Theorem \cite{brewer2000towards}.


The \textbf{FLP} Theorem states that, in an asynchronous network where messages may be delayed but not lost, it is impossible to achieve both reliability and consensus in the presence of process failures. In other words, it's only possible to guarantee two of the following properties at the same time:
\begin{itemize}
    \item Finality or Agreement, that is, if (functioning) have to decide on a value, they all decide one specific one.
    \item Fault Tolerance or Integrity, the system still functions in case of node failures.
    \item Termination or Liveness, where all the functioning nodes decide on value.
\end{itemize}



On the other hand, the \textbf{CAP} Theorem states that, in an asynchronous network where messages may be lost, it is impossible for a distributed system to simultaneously provide the following:
\begin{itemize}
    \item Consistency - all nodes see the same data at the same time
    \item Availability - every request receives a response, without guarantee that it contains the most recent version of the data
    \item Partition Tolerance - the system continues to operate despite arbitrary partitioning due to network failures.
\end{itemize}

Figure \ref{fig:theorems} illustrates these theorems/propreties.

\begin{figure}[H]
    \centering
    \includegraphics[width=\textwidth,keepaspectratio]{imagens/flp-and-cap.png}
    \caption{FLP and CAP theorems}
    \label{fig:theorems}

\end{figure}



These (and other) theorems provide limits and trade-offs in decentralized systems, and serve as a useful reference for designers and researchers in the field.
In the following sections, more insight about these propreties will be provided and why they are relevant to the topic of Blockchain networks.

\subsection*{Permissioned and Permissionless Blockchains}

Blockchains are a type of decentralized system that uses consensus algorithms to maintain the integrity of its data. In the context of blockchains, the terms ``permissionless'' and ``permissioned'' refer to the way in which participants in the network are allowed to participate in the validation of transactions and the creation of new blocks.
These terms are critical in understanding the trade-offs between security, scalability, and decentralization in blockchains. In this section, we will delve deeper into what ``permissionless'' and ``permissioned'' mean and the advantages and disadvantages of each approach.

\textbf{Permissionless blockchains}, also known as public blockchains, are open to anyone and anyone can participate as a node. No central authority or entity is in control, making it a completely decentralized system. Permissionless blockchains are most often used for cryptocurrencies such as Bitcoin, Tezos and most of popular networks, where anyone can participate in the network and validate transactions, contributing to the security and reliability of the network.

\textbf{Permissioned blockchains}, also known as private blockchains, are restricted to a set of trusted participants. Only approved entities are allowed to participate as nodes and validate transactions, making it a partially decentralized system. This type of blockchain is often used in business environments where the participants are known and trusted, and where confidentiality and privacy are important considerations. Usually this networks are faster and more secure, since the number of participating nodes is way smaller and the fact that nodes are ``handpicked'', they are already trusted.
% TODO: Adicionar references
Known examples are Hyperledger-Fabric \cite{androulaki2018hyperledger}, an enterprise-grade network and Binance Smart Chain \cite{bnb-chain_2022}, a cryptocurrency network that's a fork of Ethereum \cite{ethereum_foundation}.

\subsection*{Processes of Block creation}
In the context of blockchain networks, there's a need for nodes selecting the next update to the state, or the next block to add to the blockchain structure. At each round/heartbeat of the network, a proposer decides on the structure of the block (in a cryptocurrency blockchain, the proposer selects the transactions to include in the block).

In this subsection, we will explore the two main ways of reaching consensus/selecting a leader in blockchain networks: proof-based consensus and committee-based consensus.

\textbf{Proof-based consensus} protocols rely on the concept of proof of leadership. Nodes are selected to generate new blocks through a cryptographic random algorithm. The selection of the new leader/proposer is similar to the idea of a lottery. The node that wins such lottery has the right to propose a new block.
Nodes validate transactions, generate a Merkle Tree Root of these, and package them into a new block. The leader node broadcasts the new block and its proof of leadership to the network, that validates the new block, and upon validation, it appends it to the blockchain.

In \textbf{committee-based consensus} protocols, nodes vote to decide the next block to be appended to the blockchain. The proposer multicasts a preparation block request to other participants, who reply with their status. If the proposer receives a sufficient number of ready messages, it enters the pre-commit phase. Participants then broadcast their votes to commit the proposed block. If the number of commit responses agreeing to the new block exceeds a threshold, the block is appended to the blockchain.

\subsection*{Blockchain ``trillema''}

Another subject that is usually used to compare different blockchain networks, with much discussion, is the topic of the ``Blockchain trilemma'' \cite{buterin} that refers to the trade-off between scalability, security, and decentralization. 
In other words, it is hard, if not impossible to achieve all these three characteristics at the ``same time'' in a public/permissionless blockchain network:
\begin{itemize}
    \item \textbf{Decentralization}: refers to the distribution of power and decision-making authority across all participants in the network. In blockchain, this means that there is no central authority or single point of control, allowing for a more equal and democratic system.
    \item \textbf{Security}: refers to the robustness and reliability of the network, ensuring that data and transactions are protected from tampering, hacking, or other forms of malicious activity.
    \item \textbf{Scalability}: refers to the ability of the network to handle a growing number of transactions and users, without sacrificing performance or speed.
\end{itemize}

Even though that in the context o distributed systems the topic of decentralization isn't relevant, when talking about blockchain networks it's important, as it's one of the main reasons why people use these systems in the first place.

For example, Bitcoin is a highly decentralized and secure blockchain, as there are many nodes (More than 40 thousand  \cite{bitnodes}, as of the writing of this document), yet lacks on scalability, since the creation of a block takes 10min and a transaction takes about 1 to 1.5 hours to complete/be confirmed \cite{gondek}\label{exampleoftime}.

Therefore, when designing a blockchain network, it is important to understand the trade-offs between scalability, security, and decentralization and to make trade-offs based on the specific goals and requirements of the network.

Figure \ref{fig:trillema} illustrates this trillema. It's common to assign blockchain network as a point in the area of this triangle. For example, since Bitcoin is secure and decentralized, yet lacks scalability, one could assign a point near the line between ``secure'' and dec

\begin{figure}[H]
    \centering
    \includegraphics[width=\textwidth/2,keepaspectratio]{imagens/trilemma.png}
    \caption{Blockchain trillema}
    \label{fig:trillema}

\end{figure}



\section{State of the Art of Consensus Algorithms in Blockchain Networks}
\label{stateoftheart}

In the world of blockchain, consensus algorithms play a crucial role in maintaining the integrity and security of the network. They are the backbone of a blockchain's ability to ensure that all nodes agree on the state of the network, even in the presence of malicious actors, and they are of big importance not only in the matter of ensuring the continuation of the network, but they also play a political and philosophical role in the network.
As blockchain technology continues to evolve, so do the consensus algorithms used to secure them.
Not only they differ on the question of ``Blockchain trillema'', but each blockchain network has specific characteristics and functionalities that make it unique.

In this State of the Art section, we will delve into the most commonly used consensus algorithms in blockchain technology. We will examine the different strengths and weaknesses of each algorithm and discuss their suitability for different use cases. We will explore milestone and popular protocols, as well as compare them.

This will further expose that there's way too many blockchain consensus protocols to choose for when creating a new network.
The reader can find more information about the topics discussed in this section here \cite{xu2023survey} and here \cite{ferdous2020blockchain}.


\subsection*{\textbf{Proof of Work}}

Proof of work (PoW) \cite{back2002hashcash} was originally introduced as a solution to the problem of spamming and abuse on the Internet. In a proof of work system, a computational problem is designed such that it requires a significant amount of computational effort to solve, but its solution can be easily verified. The idea is that, by requiring a party to perform a certain amount of computational work in order to perform a certain action, such as sending an email or posting a message, the system can ensure that the action is performed in a responsible and controlled manner.

The first use of proof of work was in the context of a system for fighting email spam, designed by computer scientist Adam Back in 1997. In this system, an email sender was required to perform a certain amount of computational work, in the form of solving a cryptographic puzzle, in order to send an email. The idea was that the cost of performing the work would make it unfeasible for spammers to send large quantities of unsolicited email, while still allowing legitimate users to send email without significant difficulty.


Proof of Work was later adapted as a consensus algorithm used by many blockchain network, Bitcoin \cite{nakamoto2008bitcoin} being the most popular network to do so.
Bitcoin or ``Nakamoto Consensus'' was also the first instance of a Proof of Work Consensus and of a blockchain network.

The idea behind PoW (applied to blockchain networks) is that, in order for a block (containing a list of transactions) to be added to the blockchain (and replicated), at least one node in the network has to package together a list of transactions into a block and solve a cryptographic hard problem in order for it to be valid.
That is, the block has to contain a stamp or a proof that actual computational work was put in to create a block.
That work/computational power is provided by nodes called ``miners'', and these miners compete to be the first to solve the cryptographic puzzle, where the first to solve it is selected as the leader and has the ability to add the their created block to the blockchain.

In a permissionless environment, it's complex to make a democratic system where each entity could cast a vote, since a malicious entity could create many fake identities or nodes to manipulate the network, known as a ``sybil attack''.
In blockchain networks, entities make use of Public-key cryptography to be identified, so a malicious entity could create as many pairs of Public-Private keys as it wished to cast as many votes as it wanted.

PoW or ``Nakamoto Consensus'' was the first to be tolerant to sybil attacks in a permissionless setting.
It prevents these attacks by making it computationally expensive for an attacker to try to disrupt the network, since, instead of voting power being concentrated on the number of votes for an election, it's replaced by the idea of computational power, where an attacker would have to do as much work as the rest of the network in order to gain a majority, and that could imply problems to the malicious entity, like large electricity costs in case of mining.
By requiring a significant amount of computational power to mine blocks, PoW ensures that only legitimate nodes with real computational resources will be able to participate in the network.
Mining is what is called coequally to the process of using computational power to solve cryptographic puzzles and adding blocks to the blockchain.

In other words, instead of entities voting for a block to be added to the blockchain, the ``vote'' is done by solving puzzles, where the first to solve such puzzle is the one deciding the block to be added.

Mining has several purposes in PoW, such as leader selection and preventing sybil attacks, like mentioned before, but also enforcing block timing with difficulty adjustment and in case of cryptocurrency blockchains, to add new value/mint new currency into the system. 

The difficulty adjustment ensures that the time between blocks is consistent (in Bitcoin, that is 10min), and the computational difficulty to mine new blocks adjusts accordingly. When in a epoch (in Bitcoin, that is 2016 blocks), the median time taken to mine a block was lower than it should've been, the difficulty is increased proportionally to make it harder to mine, so it actually takes the pretended time, and vice versa.

The mining also introduces/mints new currency into the system, since itself doesn't have any value in it initially (it's a closed economic system), and that currency is awarded to the participants of the mining process.


\subsection*{Properties of Proof of Work Consensus}

The properties of PoW consensus can be analyzed through the FLP theorem and the CAP theorem, which were discussed in the previous section.

Regarding the FLP theorem, PoW exhibits Probabilistic Finality \cite{anceaume2020finality}. This means that all functioning nodes eventually agree on a single block, but the process is not deterministic and involves a certain degree of probability. The waiting for confirmations adds an additional layer of security to the consensus process. Like mentioned before in this example (\ref{exampleoftime}) in Bitcoin this takes about 6 confirmations, or about 1 hour, since a block usually takes 10 minutes to created. This happens because mining is a process independent from the state of the network and independent from other nodes, and two or more nodes can solve the cryptographic puzzle/build a block ``at the same time'' (until the whole network agrees on the same block).
When this happens, a node can receive more than one valid candidate extending the same chain, and each protocol handles this in a specific way. This is what is called a ``Fork''.
Once again, taking Bitcoin as an example, a node handles this case by using the rule of the longest chain (Longest Chain Rule), where, when a node has two competing blocks, where each makes a branch, it waits until one of the branch is bigger than the other.
This is done because, the branch with the most computational power is the one with the bigger chance of being extended.

PoW also demonstrates Fault Tolerance, making it a form of Byzantine Fault Tolerance (BFT). This is achieved through the complex and expensive mining process, which makes it economically infeasible for a malicious node to alter the data in a block and catch up with the rest of the network. The incentive to follow the longest blockchain also adds to the fault tolerance of the consensus mechanism.

Finally, PoW also exhibits Termination, meaning that every functioning node reaches a decision, even if it's not the final one (because of the Probabilistic Finality). 

Regarding the CAP theorem, PoW does not provide Consistent results, as a node might not have the latest block when requested, and like mentioned before, forks can happen, and so different nodes can contain different chains (for a period).
However, it does provide Availability, as miners are continuously trying to mine new blocks, the difficulty level of mining is adjusted to ensure the steady addition of blocks to the blockchain and there are multiple nodes in the network.
PoW is also Partition Tolerant, meaning that even if a portion of the nodes stop functioning or the network splits, the blockchain can still function and recover.

\subsection*{Nakamoto Consensus}
In the previous subsection, we discussed the consensus mechanism used in blockchain technology where participants in the network compete to solve complex mathematical puzzles in order to validate transactions and generate new blocks.
We introduced the concept of miners, who play a crucial role in this process, and how they are incentivized through rewards for their efforts.

Building on this foundation, we now delve into the specifics of the Nakamoto Consensus, named after the pseudonym used by the unknown creator(s) of Bitcoin (Satoshi Nakamoto). The Nakamoto Consensus is a milestone in the history of blockchain technology and a major innovation in the field of consensus algorithms.

The Bitcoin network is a Peer-to-Peer network, where blocks and transactions are gossiped by the nodes and where they are also responsible for generating blocks, just like mentioned previously.

This acts as a barrier to entry for malicious actors, as it becomes extremely difficult for them to launch Sybil attacks by generating many fake nodes.
The puzzle in Bitcoin involves computing a nonce (basically, a number) that meets certain conditions, as outlined by the equation $H(hi−1,nonce,tx,par) < Target$, where hi−1 is the hash of the previous block, tx represents the set of validated transactions, and par represents other parameters such as blockchain version and cryptographic parameters.
The usual workflow of a node is the following:
\begin{itemize}
    % TODO fazer referncias sobre o header do bloco da bitcoin
    \item Node gossip transactions in the network (They are stored in a data structure that is called ``Mempool'').
    \item When a node receives a block from the network, it appends it to it's own blockchain stored.
    \item To start the mining process, a node selects multiple transactions for the transaction part of the block. There's a size limit in bytes for this part, and the selection parameters are irrelevant, they only have to be valid.
    \item It creates a new block header with information, like, the hash of the previous block, a nonce (a integer number) and a Merkle Tree Root Hash of the transactions and other information (that is irrelevant to this).
    \item The node starts trying out every possible value for the nonce until the resulting hash of the header has a value bellow the current target.
    \item If a node receives a new block from the network before it finds itself the nonce, it stops the mining and appends such block. If it finds the nonce, it shares the block with the network and it's reward.
    
\end{itemize}

When a entity creates a transactions, it can also offer a fee. This is used to prevent transactions spamming and also acts as a ``spot in the block'' auction.
Besides block creation reward, the miner also receives the transactions fees, so miners will select transactions based on that fee, and other attributes of the transactions.

The difficulty of the puzzle is adjusted periodically (every 2016 blocks like mentioned before), depending on the actual block generation intervals and the expected block generation intervals of around ten minutes. This allows Bitcoin to maintain a consistent block generation time of around ten minutes, regardless of the computational power in the network.

\subsection*{Improving Proof of Work}

The Nakamoto Consensus protocol, despite being the first consensus mechanism for block\-chains and widely adopted, has limitations when it comes to scalability, security, and decentralization.

There are multiple ways of improving the Nakamoto Consensus protocol, and doing so has resulted in the creation of new blockchain networks. These changes move the consensus protocol within the triangle formed by the ``trillema'', but they also come with new challenges compared to the original consensus for blockchains.

This topic is relevant to this dissertation since it's these characteristics that differentiate consensus even further.

\subsection*{Improving Scalability}
Blockchain networks have faced scalability issues since their inception. A consensus mechanism must maintain security and decentralization, so it's challenging to scale the network and improve the transaction processing speed. To overcome this challenge, several solutions have been proposed, including decoupling blockchain functions, parallel chains, and DAG-based protocols.

\textbf{Decoupling of Blockchain Functions}: The functions of blocks in a blockchain network can be separated into key blocks for leader election and microblocks for transaction packing. By doing so, the miner who successfully solves the puzzle becomes the leader of an epoch and generates key blocks and microblocks. This method helps to improve the throughput of the network, but it doesn't significantly reduce the transaction confirmation latency. Also, it comes with problems such as the fact that the leader can be compromised during the epoch.

\textbf{Parallel Chains}: The parallel chains method involves miners extending parallel chains simultaneously to improve the blockchain throughput. In this method, miners compete to solve puzzles, and the generated block is appended to one of the chains based on the random hash value of the puzzle solution. While this improves throughput, a malicious entity could still target a single chain.

\textbf{DAG-based Protocols}: instead of using a traditional blockchain structure, DAG-based protocols utilize a tree-like structure, called a Directed Acyclic Graph (DAG). The DAG structure allows for concurrent block generation and operates differently than blockchain structures. Unlike parallel-chain protocols that have multiple independent genesis blocks at initialization, there is only one genesis block in DAG-based protocols. If the DAG-based block\-chain follows the longest chain rule, there will only be one longest chain, instead of multiple chains in the parallel-chain scheme, and blocks on the forks will be pruned. This structure provides a unique approach to improving scalability in blockchain networks 

\subsection*{Improving Security}
Blockchain networks are vulnerable to various security attacks, such as selfish mining attacks, double-spending attacks, and liveness attacks. To improve the security of blockchain networks, various solutions have been proposed, including changing the incentive mechanism in the chain and how it's shared.

For example, some blockchain networks have adopted a new consensus algorithm that uses random incentives or that the reward of mining is shared.

\subsection*{Improving Decentralization}
% TODO: add asic to acronyms
To improve decentralization, several solutions have been proposed,
including de-incentivizing centralized activities 
like pool mining and incentivizing decentralized/solo mining using methods like eradicating ASIC (Application-Specific Integrated Circuits) mining.

Pool mining is a point of centralization in Proof of Work networks. The basic idea of pool mining is that there's a single node (connected in the network) that communicates with multiple miners, that is, entities which their only purpose is to find a nonce.
These miners get together to mine a single block as if they were only a single node, so together they have more computational power, and inherently having a bigger change of finding a block. When a block if found by the pool (the node, as viewed from the network), the reward is shared with all the miners, depending on how much effort they put into the mining.
The problem comes with the fact that most mining nowadays, in Bitcoin, is done like this, and so, the owners of these pool nodes have a lot of power over the network.

Also, with the increase of Hashing power, that is, the computational power of blockchains, in specific ``Bitcoin'', miners have improved the mining process by developing highly specialized hardware, called ASICs.

By doing so, it's infeasible for anyone to join the mining process, and centralizing the power on the owners of ASICs. So there are multiple efforts to erradicate this type of mining like by using memory-hard puzzles, that are harder for ASIC hardware than for Personal Computer Hardware (like GPUs or CPUs), or using hash functions that are hard to implement as ASICs.

\subsection*{\textbf{Proof of Stake}}
Proof of Stake (PoS) consensus protocols are an alternative to Proof of Work (PoW) consensus protocols in the context of blockchain networks, and lately have been proven to be more popular and where most of the innovation in the space is, since there are environmental concerns surrounding Proof of Work.

In PoS, nodes in the network compete to validate transactions and create new blocks based on the stake they have locked in the network.
The idea behind PoS is that the more stake a node has, the greater its chance of being selected to validate transactions and create new blocks. This selection process is done in a decentralized manner and ensures that the network is protected against malicious actors, as the stake acts as a guarantee that the node will behave according to the protocol rules.
One can compare Proof of Stake to holding stake in a company. The more stake a person has, the 

The core idea behind PoS and PoW is the same, yet "computational power" is replaced by "stake" in PoS. PoS is more energy-efficient than PoW, as it does not require nodes to solve resource-intensive cryptographic puzzles. Additionally, the stake in PoS opens up the possibility for other functionalities, such as delegation and coin slashing, as the stake is explicitly recorded on the blockchain.

However, PoS also faces challenges. Like PoW, PoS is a closed economic system, meaning that the currency has to be introduced by itself. In order for blocks to be created, there has to be someone staking, but there is no currency yet. This problem is addressed through the concept of bootstrapping, which can be done through pre-mining or transitioning from PoW to PoS.

In the context of PoS consensus protocols, the three most relevant types of Proof of Stake are: ``Chain-based'' PoS, ``BFT'' PoS, and ``Delegated'' PoS. As previously discussed in the Core Concepts and State of the Art chapter, each of these types has its own unique characteristics and strengths. For example, ``Chain based'' emphasizes the importance of maintaining a consistent state of the blockchain, while BFT PoS focuses on the efficient and secure execution of consensus in the network. Delegated PoS, on the other hand, allows for network participants to delegate their stake to trusted nodes, making it possible for a smaller subset of nodes to validate transactions and create blocks.

These will be explained in the following subsections.

\subsection*{\textbf{Chain-based Proof of Stake}}
Chain-Based Proof of Stake (ChainPoS) is a consensus algorithm that builds upon the concept of staking and the idea of block creation through the participation of stakeholders. It aims to be a more energy efficient alternative to Proof of Work (PoW) consensus, while still maintaining a level of security and decentralization.

Similar to the Nakamoto consensus, Chain PoS operates on the idea of incentivizing stakeholders to act honestly by staking their assets. This creates a guarantee that stakeholders will behave in accordance with the protocol rules, as any malicious behavior would result in the loss of the staked assets. The bigger the stake locked, the bigger the chance of being selected as the next block creator in a decentralized manner.

When compared to PoW, Chain PoS replaces computational power with stake. This leads to a reduction in energy consumption as the protocol does not require solving resource-intensive cryptographic puzzles. In addition, Chain PoS allows for other functionalities to be built around the stake, such as delegation, coin slashing, and more, as the stake is explicitly represented on the blockchain.

There are two main approaches for block creator selection in Chain PoS, randomized stakeholder selection, and a hybrid between PoW-like selection and randomized stakeholder selection. In randomized stakeholder selection, the node executes a random algorithm to determine whether they are selected as the leader, taking into account the staked currency and other parameters. The hybrid approach, seen in Peercoin, combines PoW and PoS block creation.

Coin age is a critical concept in PoS block generation. It refers to the amount of time that a stake has been locked and is used as the core of PoS block generation. The longer the stake has been locked, the more valuable it becomes, leading to a higher chance of being selected as the next block creator.

Peercoin \cite{peercoin_foundation} was the first to successfully implement PoS and represents a milestone in its development. Its hybrid consensus of PoW and PoS, and its use of coin age as the core of PoS block generation, set it apart from other PoS-based protocols. The stake in Peercoin is represented by coin age consumption, and block generation priority is determined by the amount of coin age consumed. The most-staked chain is used to determine the authoritative chain, providing double-spending attack protection through the consumption of an adversary's coin age.

However, there are limitations to PoS-based protocols, including the need for additional security assumptions. PoSAT is a proposal for improving the security of PoS-based protocols by using Verifiable Delay Function to avoid these assumptions. Dynamic availability is also a critical aspect in blockchain systems, and PoSAT plays a role in achieving it.

Another example of a Chain PoS protocol is Casper FFG \cite{buterin2017casper}, which was designed by Ether\-eum's co-creator, Vitalik Buterin. It aims to provide a more energy efficient alternative to PoW while still maintaining the security of the network.

In conclusion, Chain Proof of Stake is a promising alternative to Proof of Work consensus, offering energy efficiency and the potential for additional functionalities built around the stake. However, there are still challenges to be addressed, such as the need for additional security assumptions and the importance of dynamic availability in blockchain systems.


\subsection*{\textbf{BFT Proof of Stake}}

BFT (Byzantine Fault Tolerant) Proof of Stake is a consensus algorithm that ensures the security and reliability of the blockchain network. This consensus mechanism has been developed to tackle the issue of Byzantine faults in decentralized systems, which is the idea that one or more nodes in a network may act maliciously, causing the network to behave in unpredictable and undesirable ways. The BFT PoS algorithm offers a solution to this problem by introducing a multi-round consensus process that involves validator selection and the use of quorums of super-majority to tolerate Byzantine behavior.

The BFT PoS algorithm is a Byzantine Fault Tolerant consensus protocol that operates in a partially synchronous network. It is designed to ensure the security and reliability of the blockchain network by making use of cryptographic sampling algorithms for validator selection, validator voting and block confirmation processes, and record-keeping of validator votes and calculation of block probability. The algorithm uses a personalized security threshold for each node in the consensus algorithm to achieve consensus in the network.

Byzantine Fault Tolerance \cite{lamport2019byzantine} refers to the ability of a decentralized system to maintain its functionality even when one or more nodes in the network act maliciously. This is a critical requirement for blockchain networks, where the risk of Byzantine faults increases with the size and complexity of the network.

The BFT PoS algorithm operates in a multi-round consensus process, where the validators participate in multiple rounds of voting to reach consensus on the state of the blockchain. The consensus process consists of several steps, including proposal, pre-vote, and pre-commit, which are executed in a deterministic order to ensure that the network reaches consensus.

Validator selection is an important aspect of the BFT PoS algorithm, as it determines the set of validators that will participate in the consensus process. This is done through a cryptographic sampling algorithm, which takes into account the validators' security deposits and other parameters to select a quorum of validators for each round of consensus.

The BFT PoS algorithm requires a quorum of super-majority, which means that a certain percentage of the validators must reach consensus on the state of the blockchain before it can be considered final. This helps to ensure that the network is robust against Byzantine faults, as a malicious node would need to compromise a large percentage of the network to compromise the consensus process.

The BFT PoS algorithm is designed to tolerate Byzantine behavior, meaning that it can continue to function even if one or more nodes in the network act maliciously. This is achieved through the use of quorums of super-majority and personalized security thresholds, which help to prevent a malicious node from compromising the consensus process.

In the event of a network partition, the BFT PoS algorithm must choose between consistency and availability, as both cannot be achieved simultaneously. The algorithm prioritizes consistency, meaning that the network will remain in a consistent state even if it is unavailable for a period of time. This helps to ensure the security and reliability of the blockchain network.

The BFT PoS algorithm is executed in a partially synchronous network, where the network can operate at different speeds for different nodes. This is a more realistic model for decentralized systems, as it allows for the possibility of network delays and variable network speeds. The algorithm is designed to accommodate this by making use of personalized security thresholds and locking mechanisms to ensure the

BFT Proof of Stake consensus protocols have become increasingly popular in recent years due to their combination of security and efficiency. In a BFT PoS system, validators are selected through a cryptographic sampling algorithm and play a crucial role in the consensus process. The validators vote on each block and reach a consensus through a multi-round process. To ensure a high level of security, the system is designed to tolerate byzantine behavior and a quorum of super-majority is required for block confirmation. The consensus algorithm also balances consistency and availability in case of network partitions.

Tendermint is a popular implementation of BFT PoS that has been widely adopted in the Cosmos ecosystem of blockchains. It consists of two components, Tendermint Core and ABCI, and acts as a consensus plugin that can be integrated with other blockchain systems. Tendermint Core uses a round-based consensus algorithm and determines the validator with the most voting power to be the proposer in each round. The consensus process involves three steps: propose, pre-vote, and pre-commit. To ensure the safety of the system, nodes must bond a security deposit and the protocol requires 100\% uptime of the super-majority of validators.

Tenderbake is a consensus protocol based on the Tendermint consensus engine and integrated into the Tezos blockchain, this blockchain being a focus in later sections of this document.

In conclusion, BFT Proof of Stake consensus protocols provide a secure and efficient alternative to traditional proof of work algorithms. With the introduction of Tendermint and other implementations, BFT PoS has become a key component in the development of blockchain technology and its integration into various industries.

\subsection*{\textbf{Delegated Proof of Stake}}

Delegated Proof of Stake (DPoS) is a consensus algorithm that combines elements of both Proof of Stake (PoS) and democratic governance. In DPoS, the network's stakeholders vote for a set of delegates, who are responsible for maintaining the network's consensus and proposing new blocks. These delegates, or validators, are selected based on various mechanisms such as reputation scores or other metrics that reflect the trustworthiness of the node.

DPoS is distinct from other PoS algorithms in that it aims to balance the need for decentralization with the need for efficiency and speed. By having a smaller number of delegates (making it less decentralizzed), DPoS reduces the amount of computational resources required to maintain network consensus, thereby improving network scalability. This also allows for faster transaction processing times and more efficient consensus compared to traditional PoS algorithms.

Delegates have a key role in the DPoS algorithm, as they are responsible for proposing new blocks and maintaining the network's consensus. The leader of the network, or the delegate with the most votes, is selected to be the block proposer for a given round. The leader is incentivized to behave honestly through rewards and penalties, which can be implemented via the application layer. Additionally, there is competition among delegates to earn the most votes, which motivates them to provide better services to the network's stakeholders.

Incentives for voters are also important in DPoS. The network's stakeholders have a direct say in the selection of delegates and have the ability to vote for delegates who align with their interests. Incentives for voters can come in the form of rewards for participating in the voting process or penalties for not doing so.

DPoS can be integrated with other PoS algorithms to enhance the security and efficiency of the network. For example, it can be used as a consensus mechanism in combination with a BFT PoS algorithm to provide a more robust network that is resistant to both Byzantine faults and network partitioning.

In conclusion, the Delegated Proof of Stake algorithm provides a unique balance between decentralization, scalability, and efficiency. Its combination of democratic governance and PoS consensus makes it a versatile algorithm that can be integrated with other PoS algorithms to enhance the security and performance of the network.

\subsection*{\textbf{Other Consensus Protocols}}

Apart from Proof of Work and Proof of Stake, there are other consensus algorithms that are used in the blockchain industry. However, they are not as popular as PoW and PoS and are mainly used in niche applications or not used in the popular cryptocurrency blockchains. In this section, we will explore and explain some of these alternative consensus algorithms.

In this subsection we will enumerate and give a overview of a few of these consensus algorithms.

\textbf{Proof of Burn} \cite{karantias2020proof} shares some characteristics with Chain-based Proof of Stake. In this algorithm, instead of staking, the node sends some tokens to an address that is difficult to access, essentially "burning" them. The node can then mine or validate blocks proportionate to the amount of tokens that were burned. The idea behind Proof of Burn is that a node is willing to sacrifice tokens, making it less likely that they would act maliciously as they would lose their investment.

\textbf{Proof of Research} \cite{gridcoin} algorithm is used in some cryptocurrencies that aim to provide an environmentally friendly alternative to Proof of Work. In this algorithm, nodes perform research tasks that can range from solving mathematical problems to annotating data. The first node to complete the task is allowed to mine the block, providing a solution to the computational waste that is inherent in PoW.

\textbf{Proof of Capacity/Space/Storage} \cite{dziembowski2015proofs} shares some characteristics with Proof of Work but also suffers from a lighter version of the nothing-at-stake problem. In this algorithm, nodes are required to dedicate a certain amount of disk space for storage. The more disk space a node dedicates, the more chances it has of being selected to mine the next block. The algorithm is energy-efficient compared to PoW, but it still suffers from centralization problems as nodes with more disk space are more likely to be selected to mine blocks. These kinds of protocols are often used in conjunction with other blockchain networks (Proof of Work or Proof of Stake) to store large amounts of information that wouldn't be feasible to store directly in those blockchains.

\textbf{Trusted Computing} \cite{bowman2021elapsed} algorithms use the secure hardware provided by Trusted Execution Environments (TEEs) to secure the consensus mechanism. One example of such an algorithm is POET, used in the Hyperledger Sawtooth blockchain platform. In POET, a trusted party generates a wait time for each node and the first node to complete the wait time is allowed to mine the next block. The use of TEEs ensures that the wait time cannot be tampered with, providing a secure mechanism for consensus.

There are many alternative consensus algorithms that are used in the blockchain industry, each with its strengths and weaknesses.
While some, like Proof of Burn and Proof of Research, offer environmentally friendly alternatives, others, like Proof of Capacity/Space/Sto\-rage, still suffer from centralization problems. Trusted Computing Algorithms, like POET, provide secure consensus mechanisms, but rely on trusted hardware that may not be readily available. Ultimately, the choice of consensus algorithm will depend on the specific use case and requirements of the blockchain platform.

\subsection*{\textbf{Lupin Language}}
\label{lupin}

The Lupin Language is a Domain-Specific-Language (DSL) that is currently in its early stages of development. 
The process of compilation of this language results in OCaml code.
It is designed to simplify the process of designing and coding consensus algorithms, which can be a challenging task that requires a significant amount of expertise and resources.

Not only that, but it can also be used to perform rigorous formal analysis and verification on this algorithms. 
This brings a whole new level of capability to analyzing consensus algorithms and will be an important tool in the future.
This project provide will provide feedback for the development of Lupin and may also serve as a layer of execution for the results of its compilation. 
This project is in collaboration with the Lupin Language project and its results will be further exposed in a later section.


\subsection*{State of the Art Conclusion}
The field of consensus algorithms in blockchain technology is constantly evolving. In this State of the Art section, we have explored the most commonly used consensus algorithms, from the energy-intensive Proof of Work to the scalable and efficient Proof of Stake algorithms. We have looked at the strengths and weaknesses of each algorithm and discussed their suitability for different use cases. We have also examined other alternative consensus algorithms, the niche uses for which they are best suited and a DSL used to describe this type of algorithms.

It is clear that no single consensus algorithm is the best for all blockchain projects. Each algorithm has its own strengths and weaknesses, and the best algorithm will depend on the specific requirements of the project. Whether you are a developer, entrepreneur, or researcher, this State of the Art section provides valuable insights into the current state of consensus algorithms in blockchain technology and will help you make informed decisions when choosing a consensus algorithm for your blockchain project.

\section{Conclusion}
This chapter provides a comprehensive overview of the core concepts of blockchains and the state of the art in consensus algorithms. With so many different consensus protocols available, it is essential to have a clear and concise way to compare and evaluate them. As the field of blockchain continues to evolve, the development of more effective consensus algorithms will be a critical factor in determining the success of blockchain networks. By gaining a deeper understanding of the current state of the art, researchers and developers can work towards developing new consensus algorithms that are more secure, efficient, and scalable than ever before.
